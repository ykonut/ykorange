---
{"dg-publish":true,"permalink":"/计量经济学/条件期望函数及其性质/","tags":["线性模型"]}
---


## 条件期望函数

设 $Y$ 和 $X$ 是两个随机变量，对于任意一个实数 $x\in \text{supp}(X)$ 都仅存在一个实数 $E[Y\mid X=x]$ 与之对应，因此可以构造随机变量 $X$ 的映射 $X\to E[Y\mid X]$，称 $E[Y\mid X]$ 为条件期望函数。

## Law of Iterated Expectations

**Theorem** 
$$
E_{X}[E_{Y}(Y\mid X)]=E[Y]
$$
**Proof**
离散型随机变量
$$
\begin{align*}
E_{X}[E_{Y}(Y\mid X)]
&=\sum\limits_{x}E_{Y}(Y\mid X=x)P(X=x)\\
&=\sum\limits_{x}\sum\limits_{y}y\cdot P(Y=y\mid X=x)P(X=x)\\
&=\sum\limits_{x}\sum\limits_{y}y\cdot P(X=x\mid Y=y)P(Y=y)\\
&=\sum\limits_{x}P(X=x\mid Y=y)\sum\limits_{y}y\cdot P(Y=y)\\
&=\sum\limits_{y}y\cdot P(Y=y)\\
&=E[Y]
\end{align*}
$$
连续型随机变量
$$
\begin{align*}
E_{X}[E_{Y}(Y\mid X)]&=\int_{x} E_{Y}(Y\mid X) f_{X}(x) \mathrm{d}x\\
&=\int_{x} \int_{y}y \cdot f_{Y\mid X}(y\mid x) \mathrm{d}y f_{X}(x) \mathrm{d}x\\
&=\int_{x}\int_{y}y\cdot f_{X\mid Y}(x\mid y)f_{Y}(y)\ \mathrm{d}y \mathrm{d}x\\
&=\int_{x}f_{X\mid Y}(x\mid y) \mathrm{d}x\int_{y}y\cdot f_{Y}(y) \mathrm{d}y\\
&=\int_{y}y\cdot f_{Y}(y)\mathrm{d}y\\
&=E[Y]
\end{align*}
$$
推论：将 $E(Y|X)$ 整体视为一个随机变量
$$
E(Y|X)=E_{Z}[E_{Y}(Y|X,Z)\mid X]
$$
## Best Predictor

**Theorem** Let $g(X)$ be any function of $X$, then
$$
E[Y|X]=\mathop{\arg\min}\limits_g E[(Y-g(X))^2]
$$
**Proof**
$$
\begin{align}
E[(Y-g(X))^2]
=&E[(Y-E[Y|X]+E[Y|X]-g(X))^2] \\
=&E[(Y-E[Y|X])^2]+E[(E[Y|X]-g(X))^2]+ \\
&+2E[(Y-E[Y|X])(E[Y|X]-g(X))]
\end{align}
$$
the first term
$$
E[(Y-E[Y|X])^2]=E\{(Y-E[Y|X])^2|X\}=E\{Var[Y|X]\}\ge0
$$
the last term
$$
\begin{align}
&2E[(Y-E[Y|X])(E[Y|X]-g(X))] \\
=&2E[E\{(Y-E[Y|X])(E[Y|X]-g(X))|X\}] \\
=&2E[(E[Y|X]-g(X))E\{Y-E[Y|X]|X\}] \\
=&2E[(E[Y|X]-g(X))\{E[Y|X]-E[Y|X]\}] \\
=&0
\end{align}
$$
therefore, take
$$
g(X)=E[Y|X]
$$
因此，条件期望函数 $E[Y\mid X]$ 是给定 $X$ 对 $Y$ 做出的**最小平方预测**。