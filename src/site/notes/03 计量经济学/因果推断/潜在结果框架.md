---
{"dg-publish":true,"permalink":"/03 计量经济学/因果推断/潜在结果框架/","created":"2024-07-25T11:41:15.000+08:00","updated":"2024-09-09T19:46:08.336+08:00"}
---

## 实验研究

For unit $i$, we have pretreatment covariates $X_{i}$, a binary treatment indicator $D_{i}$, and an observed outcome $Y_{i}$ with two potential outcomes $Y_{i}(1)$ and $Y_{i}(0)$ under the treatment and control, respectively. For simplicity, we assume
$$
\{ D_{i},X_{i},Y_{i}(0),Y_{i}(1) \}_{i=1}^n \overset{iid}{\sim} \{ D,X,Y(0),Y(1) \}
$$
So we can drop the subscript $i$ for quantities of this population.

**Definition** Potential outcome of $Y$
$$
Y=
\begin{cases}
Y(0),\text{ if }D=0 \\
Y(1),\text{ if }D=1 
\end{cases}
$$
**Definition** Treatment effect of unit $i$
$$
TE\equiv Y(0)-Y(1)
$$
**Definition** Average treatment effect on the treated
$$
ATT\equiv E[TE\mid D=1]=E[Y(1)-Y(0) \mid D=1]
$$
**Definition** Average treatment effect on the untreated
$$
ATU\equiv E[TE\mid D=0]=E[Y(1)-Y(0) \mid D=0]
$$
**Definition** Average Treatment Effect
$$
ATE\equiv E[TE]=E[Y(1)-Y(0)]=ATT\times P(D=1)+ATU\times P(D=0)
$$
**Definition** 处理效应的朴素被估量(naive estimand)定义为
$$
\Delta=E[Y\mid D=1]-E[Y\mid D=0]=E[Y(1)\mid D=1]-E[Y(0)\mid D=0]
$$
比较 $\Delta$ 和 $ATT$、$ATU$ 的差异
$$
\begin{align}
\Delta-ATT & =E[Y(0)\mid D=1]-E[Y(0)\mid D=0] \\
\Delta-ATU & =E[Y(1)\mid D=1]-E[Y(1)\mid D=0]
\end{align}
$$
这说明如果处理组和对照组的潜在结果不同，估计组平均处理效应时就会存在**选择偏差**。

比较 $\Delta$ 和 $ATE$ 的差异
$$
\begin{align}
\Delta-ATE & =\Delta-ATT\times P(D=1)-ATU\times P(D=0) \\
 & =(\Delta-ATT)+(ATT-ATU)\times P(D=0) \\
 & =(\Delta-ATU)+(ATU-ATT)\times P(D=1)
\end{align}
$$
两个等式对应两种分解方法，分解为相应组的**选择偏差**和**异质处理效应**。

选择偏差消失的充分条件为 $\{ Y(0),Y(1) \} \perp \!\!\! \perp D$，即是否接受处理是随机的。然而这个假设太强，因此在观察研究中需要寻求其他更容易实现的假设。

## 观察研究

**Definition** Conditional average treatment effect on the treated
$$
ATT(X)\equiv E[Y(1)-Y(0) \mid D=1,X]
$$
**Definition** Conditional average treatment effect on the untreated
$$
ATU(X)\equiv E[Y(1)-Y(0) \mid D=0,X]
$$
**Definition** Conditional average Treatment Effect
$$
ATE(X)\equiv E[Y(1)-Y(0)\mid X]=ATT(X)\times P(D=1)+ATU(X)\times P(D=0)
$$
**Definition** 条件处理效应的朴素被估量(naive estimand)定义为
$$
\Delta(X)=E[Y\mid D=1,X]-E[Y\mid D=0,X]=E[Y(1)\mid D=1,X]-E[Y(0)\mid D=0,X]
$$
 
比较 $\Delta(X)$ 和 $ATT(X)$、$ATU(X)$ 的差异
$$
\begin{align}
\Delta(X)-ATT(X) & =E[Y(0)\mid D=1,X]-E[Y(0)\mid D=0,X] \\
\Delta(X)-ATU(X) & =E[Y(1)\mid D=1,X]-E[Y(1)\mid D=0,X]
\end{align}
$$
给定 $\{ Y(0),Y(1) \}\perp \!\!\! \perp D\mid X$，此时
$$
ATT =E[ATT(X)\mid D=1]=E[\Delta(X)\mid D=1]
$$
> [!ATTENTION]
> 事实上，要使得 $ATT$ 存在还需要按条件 $X$ 划分的所有层均同时包含处理组和对照组，这样才存在相应的朴素估计量 $\Delta(X)$。形式化表述为
> $$
\exists \epsilon>0\quad\epsilon<P(D=1\mid X=x)<1-\epsilon
> $$
> 这个技术性假设和条件独立假设合称强可忽略性（strong ignorability）假设。

类似地，给定 $\{ Y(0),Y(1) \}\perp \!\!\! \perp D\mid X$、无异质处理效应，此时
$$
ATE=\sum ATE(x)\times P(X=x)=\sum\Delta(x)\times P(X=x)
$$
这个式子被称为 g-formula，简单来说就是可以先将样本按 $X=x$ 分为若干层，比较每层处理组和对照组 $Y$ 的均值之差，然后再汇总起来得到平均处理效应。

再次比较 $\Delta$ 和 $ATE$ 的差异
$$
\begin{align}
\Delta & = E[Y\mid D=1]-E[Y\mid D=0] \\
 & = \sum E[Y\mid D=1,X=x]\times P(X=x\mid D=1)-\sum E[Y\mid D=0,X=x]\times P(X=x\mid D=0)
\end{align}
$$
可见 $\Delta$ 是对按 $D$ 分组汇总后作差，$ATE$ 是按 $X$ 分组作差后汇总。前者使用 $X$ 的条件概率质量函数，后者使用 $X$ 的概率质量函数。




**Definition** (identification) A parameter $\theta$ is **identifiable** if it can be
written as a function of the distribution of the observed data under certain
model assumptions. A parameter $\theta$ is **nonparametrically identifiable** if it can
be written as a function of the distribution of the observed data without any
parametric model assumptions.

> [!EXAMPLE]
> For instance, the mean $\theta=E[Y]$ is nonpara-metrically identifiable if we have IID draws of $Y$ ’s; the Pearson correlation coefficient $\theta=\rho_{XY}$ is nonparametrically identifiable if we have IID draws of the pairs $(X,Y_{i})$ ’s. In those examples, the parameters are nonparametrically identifiable automatically.
> 
> Given $X$ and assumption (1)(2), ATT&ATU&ATE are all nonparametrically identifiable.


